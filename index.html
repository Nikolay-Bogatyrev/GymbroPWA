<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#111827">
  <script>
    if (location.hostname.includes('github.io')) {
      var base = document.createElement('base');
      base.href = '/GymbroPWA/';
      document.head.insertBefore(base, document.head.firstChild);
    }
  </script>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <title>GymBro</title>
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            gray: {
              900: '#111827',
              800: '#1f2937',
              700: '#374151',
              600: '#4b5563',
              500: '#6b7280',
              400: '#9ca3af',
            }
          }
        }
      }
    }
  </script>
  
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/custom.css">
</head>
<body class="bg-gray-900 text-white min-h-screen" x-data="gymTracker()" x-init="init()">

  <!-- ========== –°–¢–†–ê–ù–ò–¶–ê: DASHBOARD ========== -->
  <template x-if="page === 'dashboard'">
  <div class="min-h-screen p-4 pb-24">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-2xl font-bold">GymBro</h1>
        <p class="text-gray-400 text-sm">–ü—Ä–∏–≤–µ—Ç, <span x-text="profile.name"></span>! üëã</p>
      </div>
      <div class="text-right">
        <p class="text-sm text-gray-400">–°—Ç—Ä–∏–∫</p>
        <p class="text-2xl font-bold text-orange-400 flex items-center gap-1">
          <i data-lucide="flame" class="w-5 h-5"></i>
          <span x-text="stats.streak"></span>
        </p>
      </div>
    </div>

    <!-- Week Progress Card -->
    <div class="bg-gray-800 rounded-2xl p-4 mb-4">
      <div class="flex justify-between items-center mb-3">
        <span class="text-gray-400">–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</span>
        <span class="text-lg font-semibold">
          <span x-text="stats.weekCompleted"></span>/<span x-text="stats.weekTotal"></span>
        </span>
      </div>
      
      <!-- Week days (—Ç–∞–ø ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É: –ø—Ä–æ–≥—É–ª–∫–∞, –∑–∞–ª –∏ —Ç.–¥.) -->
      <div class="flex gap-1 mb-3">
        <template x-for="(day, index) in getWeekDaysStatus()" :key="day.dayName + day.dateStr">
          <div class="flex-1 text-center">
            <button
              type="button"
              @click="markDayAsWorkout(day)"
              :disabled="!day.canMark"
              :title="day.canMark ? (day.completed ? '–î–µ–Ω—å —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π' : '–û—Ç–º–µ—Ç–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É (–ø—Ä–æ–≥—É–ª–∫–∞, –∑–∞–ª)') : ''"
              class="w-full h-10 rounded-lg mb-1 flex items-center justify-center transition-colors disabled:cursor-default"
              :class="{
                'bg-green-500 hover:bg-green-600 active:scale-95 cursor-pointer': day.completed && day.canMark,
                'bg-blue-500 animate-pulse hover:bg-blue-600 active:scale-95 cursor-pointer': day.isToday && !day.completed && day.canMark,
                'bg-gray-700 hover:bg-gray-600 active:scale-95 cursor-pointer': day.canMark && !day.completed && !day.isToday,
                'bg-gray-700 cursor-default': !day.canMark
              }"
            >
              <i x-show="day.completed" data-lucide="check" class="w-5 h-5"></i>
              <i x-show="day.canMark && !day.completed" data-lucide="plus" class="w-4 h-4 opacity-70"></i>
            </button>
            <span class="text-xs text-gray-500" x-text="day.dayName"></span>
          </div>
        </template>
      </div>
      
      <!-- Stats row -->
      <div class="flex justify-between text-sm">
        <div class="text-center">
          <p class="text-gray-400">–ö–∞—Ä–¥–∏–æ</p>
          <p class="font-semibold text-blue-400"><span x-text="stats.cardioMinutes"></span> –º–∏–Ω</p>
        </div>
        <div class="text-center">
          <p class="text-gray-400">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</p>
          <p class="font-semibold text-green-400">‚åÄ <span x-text="(stats.avgMood ?? 0).toFixed(1)"></span></p>
        </div>
      </div>
    </div>

    <!-- HR Zones Card -->
    <div class="bg-gradient-to-r from-red-900/50 to-orange-900/50 rounded-2xl p-4 mb-4 border border-red-700/50">
      <div class="flex items-center gap-2 mb-2">
        <i data-lucide="heart" class="w-5 h-5 text-red-400"></i>
        <span class="font-semibold">–ü—É–ª—å—Å–æ–≤—ã–µ –∑–æ–Ω—ã</span>
        <span class="text-xs text-gray-400 ml-auto">–í–æ–∑—Ä–∞—Å—Ç: <span x-text="profile.age"></span></span>
      </div>
      <div class="grid grid-cols-3 gap-2 text-center">
        <div class="bg-gray-800/50 rounded-lg p-2">
          <p class="text-xs text-gray-400">–ú–∞–∫—Å –ß–°–°</p>
          <p class="text-xl font-bold text-red-400" x-text="profile.maxHR"></p>
        </div>
        <div class="bg-gray-800/50 rounded-lg p-2">
          <p class="text-xs text-gray-400">–ñ–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ</p>
          <p class="text-xl font-bold text-orange-400">
            <span x-text="profile.fatBurnLow"></span>-<span x-text="profile.fatBurnHigh"></span>
          </p>
        </div>
        <div class="bg-gray-800/50 rounded-lg p-2">
          <p class="text-xs text-gray-400">–ò–Ω—Ç–µ—Ä–≤–∞–ª</p>
          <p class="text-xl font-bold text-yellow-400">
            <span x-text="profile.intervalLow"></span>-<span x-text="profile.intervalHigh"></span>
          </p>
        </div>
      </div>
    </div>

    <!-- Start Workout Button -->
    <button
      type="button"
      @click="page = 'select-workout'"
      class="w-full bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-5 mb-4 flex items-center justify-between shadow-lg shadow-blue-500/20 active:scale-[0.98] transition-transform"
    >
      <div class="flex items-center gap-3">
        <div class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center">
          <i data-lucide="dumbbell" class="w-8 h-8"></i>
        </div>
        <div class="text-left">
          <p class="font-bold text-lg">–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</p>
          <p class="text-blue-200 text-sm" x-text="getTodayPlan()"></p>
        </div>
      </div>
      <i data-lucide="chevron-right" class="w-6 h-6"></i>
    </button>

    <!-- Recent Workouts -->
    <div class="bg-gray-800 rounded-2xl p-4">
      <h3 class="font-semibold mb-3 flex items-center gap-2">
        <i data-lucide="calendar" class="w-5 h-5 text-gray-400"></i>
        –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
      </h3>
      <div class="space-y-2">
        <template x-for="workout in recentWorkouts" :key="workout.id">
          <div class="flex items-center gap-3 bg-gray-700/50 rounded-xl p-3">
            <div 
              class="w-10 h-10 rounded-lg flex items-center justify-center shrink-0"
              :class="getWorkoutTypeColor(workout.type)"
            >
              <i :data-lucide="workout.type === 'cardio' ? 'activity' : 'dumbbell'" class="w-5 h-5"></i>
            </div>
            <div class="flex-1 min-w-0">
              <p class="font-medium" x-text="workout.name"></p>
              <p class="text-sm text-gray-400" x-text="workout.date"></p>
            </div>
            <div class="text-right shrink-0">
              <p class="text-lg" x-text="getMoodEmoji(workout.mood)"></p>
              <p class="text-xs text-gray-400"><span x-text="workout.mood ?? workout.moodPost ?? 7"></span>/10</p>
            </div>
            <div class="flex gap-1 shrink-0">
              <button
                type="button"
                @click="editWorkout(workout)"
                class="p-2 hover:bg-gray-600 rounded-lg"
                title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
              >
                <i data-lucide="pencil" class="w-4 h-4"></i>
              </button>
              <button
                type="button"
                @click="deleteWorkout(workout.id)"
                class="p-2 hover:bg-red-500/30 rounded-lg text-red-400"
                title="–£–¥–∞–ª–∏—Ç—å"
              >
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </div>
          </div>
        </template>
      </div>
    </div>
  </div>
  </template>

  <!-- ========== –°–¢–†–ê–ù–ò–¶–ê: SELECT WORKOUT ========== -->
  <template x-if="page === 'select-workout'">
  <div class="min-h-screen p-4">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <button type="button" @click="page = 'dashboard'" class="p-2 hover:bg-gray-800 rounded-lg">
          <i data-lucide="chevron-left" class="w-6 h-6"></i>
        </button>
        <h1 class="text-xl font-bold">–í—ã–±–µ—Ä–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</h1>
      </div>
      <button type="button" @click="openManageExercises()" class="p-2 hover:bg-gray-800 rounded-lg" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏">
        <i data-lucide="settings" class="w-5 h-5"></i>
      </button>
    </div>

    <!-- Debug info (—É–±—Ä–∞—Ç—å –ø–æ—Å–ª–µ –æ—Ç–ª–∞–¥–∫–∏) -->
    <div class="text-xs text-gray-500 mb-4">
      workoutList length: <span x-text="workoutList.length"></span>
    </div>

    <!-- Workout Cards -->
    <div class="space-y-3">
      <template x-for="workout in workoutList" :key="workout.key">
        <button
          type="button"
          @click="selectWorkout(workout.key)"
          class="w-full rounded-2xl p-4 flex items-center gap-4 shadow-lg active:scale-[0.98] transition-transform"
          :class="workout.gradient"
        >
          <div class="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center p-2">
            <div x-html="getExerciseIcon(workout.exercises[0]?.icon || 'dumbbell')"></div>
          </div>
          <div class="flex-1 text-left">
            <p class="text-2xl mb-1" x-text="workout.emoji"></p>
            <p class="font-bold text-lg" x-text="workout.name"></p>
            <p class="text-white/70 text-sm">
              <span x-text="workout.exercises.length"></span> —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π + 
              <span x-text="workout.cardio"></span> –º–∏–Ω –∫–∞—Ä–¥–∏–æ
            </p>
          </div>
          <i data-lucide="chevron-right" class="w-6 h-6"></i>
        </button>
      </template>

      <!-- Cardio Only -->
      <button
        type="button"
        @click="isCardioOnly = true; page = 'cardio'; saveSession()"
        class="w-full bg-gradient-to-r from-purple-500 to-pink-600 rounded-2xl p-4 flex items-center gap-4 shadow-lg active:scale-[0.98] transition-transform"
      >
        <div class="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center p-2">
          <div x-html="getExerciseIcon('treadmill')"></div>
        </div>
        <div class="flex-1 text-left">
          <p class="text-2xl mb-1">üèÉ</p>
          <p class="font-bold text-lg">–¢–æ–ª—å–∫–æ –∫–∞—Ä–¥–∏–æ</p>
          <p class="text-white/70 text-sm">–ü–Ω/–°—Ä/–ü—Ç ‚Äî 45-60 –º–∏–Ω—É—Ç</p>
        </div>
        <i data-lucide="chevron-right" class="w-6 h-6"></i>
      </button>
    </div>
  </div>
  </template>

  <!-- ========== –°–¢–†–ê–ù–ò–¶–ê: WORKOUT ========== -->
  <template x-if="page === 'workout'">
  <div class="min-h-screen pb-32">
    
    <!-- Header -->
    <div 
      class="p-4"
      :class="currentWorkout?.gradient || 'bg-gradient-to-r from-blue-500 to-blue-600'"
    >
      <div class="flex items-center justify-between mb-2">
        <button type="button" @click="page = 'select-workout'" class="p-2 hover:bg-white/20 rounded-lg">
          <i data-lucide="chevron-left" class="w-6 h-6"></i>
        </button>
        <div class="text-center">
          <p class="text-sm opacity-80" x-text="currentWorkout?.name"></p>
          <p class="font-bold">
            <span x-text="currentExerciseIndex + 1"></span> / 
            <span x-text="currentWorkout?.exercises.length"></span>
          </p>
        </div>
        <button type="button" @click="page = 'complete'" class="p-2 hover:bg-white/20 rounded-lg text-sm">
          –ó–∞–≤–µ—Ä—à–∏—Ç—å
        </button>
      </div>
      
      <!-- Progress bar -->
      <div class="h-2 bg-white/20 rounded-full overflow-hidden">
        <div 
          class="h-full bg-white transition-all duration-300"
          :style="`width: ${((currentExerciseIndex + 1) / (currentWorkout?.exercises.length || 1)) * 100}%`"
        ></div>
      </div>
    </div>

    <!-- Exercise Card -->
    <div class="p-4">
      <div class="bg-gray-800 rounded-2xl p-4 mb-4">
        <div class="flex items-start gap-4 mb-4">
          <div class="w-20 h-20 bg-gray-700 rounded-xl p-2">
            <div x-html="getExerciseIcon(currentExercise?.icon)"></div>
          </div>
          <div class="flex-1">
            <h2 class="font-bold text-lg" x-text="selectedAlt || currentExercise?.name"></h2>
            <p class="text-gray-400">
              <span x-text="currentExercise?.sets"></span>√ó<span x-text="currentExercise?.reps"></span>
            </p>
            <p 
              x-show="currentExercise?.lastWeight !== 0"
              class="text-sm text-blue-400 flex items-center gap-1 mt-1"
            >
              <i data-lucide="trending-up" class="w-4 h-4"></i>
              –ü—Ä–æ—à–ª—ã–π —Ä–∞–∑: <span x-text="currentExercise?.lastWeight"></span> –∫–≥
            </p>
          </div>
        </div>

        <!-- Alternatives Toggle -->
        <button
          type="button"
          @click="showAlternatives = !showAlternatives"
          class="w-full text-left text-sm text-gray-400 flex items-center gap-2 mb-2"
        >
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          <span x-text="showAlternatives ? '–°–∫—Ä—ã—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã' : `–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (${currentExercise?.alts?.length || 0})`"></span>
        </button>
        
        <!-- Alternatives List -->
        <div x-show="showAlternatives" x-transition class="space-y-2 mb-4">
          <template x-for="(alt, i) in currentExercise?.alts" :key="i">
            <button
              type="button"
              @click="selectedAlt = (selectedAlt === alt ? null : alt); showAlternatives = false"
              class="w-full text-left p-2 rounded-lg text-sm transition-colors"
              :class="selectedAlt === alt ? 'bg-blue-500/30 border border-blue-500' : 'bg-gray-700'"
              x-text="alt"
            ></button>
          </template>
          <button
            type="button"
            x-show="selectedAlt"
            @click="selectedAlt = null"
            class="w-full text-left p-2 rounded-lg text-sm bg-gray-700"
          >
            ‚Üê –í–µ—Ä–Ω—É—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ
          </button>
        </div>
      </div>

      <!-- Completed Sets -->
      <div x-show="currentExerciseSets.length > 0" class="mb-4">
        <p class="text-sm text-gray-400 mb-2">–ó–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã:</p>
        <div class="flex flex-wrap gap-2">
          <template x-for="(set, i) in currentExerciseSets" :key="i">
            <div class="bg-green-500/20 border border-green-500/50 rounded-lg px-3 py-2 text-sm">
              <span class="text-green-400 font-semibold" x-text="set.weight + ' –∫–≥'"></span>
              <span class="text-gray-400"> √ó </span>
              <span x-text="set.reps"></span>
            </div>
          </template>
        </div>
      </div>

      <!-- Input Form -->
      <div class="bg-gray-800 rounded-2xl p-4">
        <p class="text-center text-gray-400 mb-4">
          –ü–æ–¥—Ö–æ–¥ <span x-text="currentExerciseSets.length + 1"></span>
        </p>
        
        <!-- Weight Input -->
        <div class="mb-6">
          <p class="text-sm text-gray-400 text-center mb-2">–í–µ—Å (–∫–≥)</p>
          <div class="flex items-center justify-center gap-4">
            <button
              type="button"
              @click="currentWeight = Math.max(0, currentWeight - 2)"
              class="w-14 h-14 bg-gray-700 rounded-xl flex items-center justify-center active:bg-gray-600"
            >
              <i data-lucide="minus" class="w-6 h-6"></i>
            </button>
            <div class="w-24 text-center">
              <p class="text-4xl font-bold" x-text="currentWeight"></p>
            </div>
            <button
              type="button"
              @click="currentWeight += 2"
              class="w-14 h-14 bg-gray-700 rounded-xl flex items-center justify-center active:bg-gray-600"
            >
              <i data-lucide="plus" class="w-6 h-6"></i>
            </button>
          </div>
        </div>

        <!-- Reps Input -->
        <div class="mb-6">
          <p class="text-sm text-gray-400 text-center mb-2">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</p>
          <div class="flex items-center justify-center gap-4">
            <button
              type="button"
              @click="currentReps = Math.max(1, currentReps - 1)"
              class="w-14 h-14 bg-gray-700 rounded-xl flex items-center justify-center active:bg-gray-600"
            >
              <i data-lucide="minus" class="w-6 h-6"></i>
            </button>
            <div class="w-24 text-center">
              <p class="text-4xl font-bold" x-text="currentReps"></p>
            </div>
            <button
              type="button"
              @click="currentReps++"
              class="w-14 h-14 bg-gray-700 rounded-xl flex items-center justify-center active:bg-gray-600"
            >
              <i data-lucide="plus" class="w-6 h-6"></i>
            </button>
          </div>
        </div>

        <!-- Record Button -->
        <button
          type="button"
          @click="recordSet()"
          class="w-full bg-green-500 hover:bg-green-600 rounded-xl py-4 font-bold text-lg flex items-center justify-center gap-2 active:scale-[0.98] transition-transform"
        >
          <i data-lucide="check" class="w-6 h-6"></i>
          –ó–∞–ø–∏—Å–∞—Ç—å –ø–æ–¥—Ö–æ–¥
        </button>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 p-4">
      <div class="flex gap-4 max-w-md mx-auto">
        <button
          type="button"
          :disabled="currentExerciseIndex === 0"
          @click="prevExercise()"
          class="flex-1 bg-gray-700 rounded-xl py-3 font-semibold disabled:opacity-50 flex items-center justify-center gap-2"
        >
          <i data-lucide="chevron-left" class="w-5 h-5"></i>
          –ù–∞–∑–∞–¥
        </button>
        <button
          type="button"
          @click="nextExercise()"
          class="flex-1 bg-blue-500 rounded-xl py-3 font-semibold flex items-center justify-center gap-2"
        >
          –î–∞–ª–µ–µ
          <i data-lucide="chevron-right" class="w-5 h-5"></i>
        </button>
      </div>
    </div>
  </div>
  </template>

  <!-- ========== –°–¢–†–ê–ù–ò–¶–ê: –û–¢–î–´–• (–¢–ê–ô–ú–ï–†) ========== -->
  <template x-if="page === 'rest'">
  <div class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="text-6xl font-bold text-blue-400 mb-4" x-text="restTimer.secondsLeft"></div>
    <p class="text-gray-400 mb-8" x-text="restTimer.type === 'exercise' ? '–°–ª–µ–¥—É—é—â–µ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ' : '–°–ª–µ–¥—É—é—â–∏–π –ø–æ–¥—Ö–æ–¥'"></p>
    <button
      type="button"
      @click="endRest()"
      class="w-full max-w-xs bg-blue-500 hover:bg-blue-600 rounded-xl py-4 font-bold text-lg"
      x-text="restTimer.type === 'exercise' ? '–°–ª–µ–¥—É—é—â–µ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ' : '–°–ª–µ–¥—É—é—â–∏–π –ø–æ–¥—Ö–æ–¥'"
    ></button>
  </div>
  </template>

  <!-- ========== –°–¢–†–ê–ù–ò–¶–ê: CARDIO ========== -->
  <template x-if="page === 'cardio'">
  <div class="min-h-screen p-4">
    
    <!-- Header -->
    <div class="flex items-center gap-3 mb-6">
      <button type="button" @click="page = isCardioOnly ? 'select-workout' : 'workout'" class="p-2 hover:bg-gray-800 rounded-lg">
        <i data-lucide="chevron-left" class="w-6 h-6"></i>
      </button>
      <h1 class="text-xl font-bold" x-text="isCardioOnly ? '–ö–∞—Ä–¥–∏–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞' : `–ö–∞—Ä–¥–∏–æ (${currentWorkout?.cardio || 30} –º–∏–Ω)`"></h1>
    </div>

    <!-- HR Zones reminder -->
    <div class="bg-gradient-to-r from-red-900/30 to-orange-900/30 rounded-xl p-3 mb-4 border border-red-700/30">
      <p class="text-sm text-gray-300 flex items-center gap-2">
        <i data-lucide="heart" class="w-4 h-4 text-red-400"></i>
        –¶–µ–ª–µ–≤–æ–π –ø—É–ª—å—Å: 
        <span class="font-bold text-orange-400">
          <span x-text="profile.fatBurnLow"></span>-<span x-text="profile.fatBurnHigh"></span> —É–¥/–º–∏–Ω
        </span>
      </p>
    </div>

    <!-- Cardio Type -->
    <div class="bg-gray-800 rounded-2xl p-4 mb-4">
      <p class="text-sm text-gray-400 mb-3">–¢–∏–ø –∫–∞—Ä–¥–∏–æ</p>
      <div class="grid grid-cols-3 gap-3">
        <template x-for="type in cardioTypes" :key="type.id">
          <button
            type="button"
            @click="cardioData.type = type.id"
            class="p-3 rounded-xl flex flex-col items-center gap-2 transition-colors"
            :class="cardioData.type === type.id ? 'bg-purple-500' : 'bg-gray-700'"
          >
            <div class="w-12 h-12" x-html="getExerciseIcon(type.icon)"></div>
            <span class="text-sm" x-text="type.name"></span>
          </button>
        </template>
      </div>
    </div>

    <!-- Duration -->
    <div class="bg-gray-800 rounded-2xl p-4 mb-4">
      <p class="text-sm text-gray-400 mb-3">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)</p>
      <div class="flex items-center justify-center gap-4">
        <button
          type="button"
          @click="cardioData.duration = Math.max(5, cardioData.duration - 5)"
          class="w-14 h-14 bg-gray-700 rounded-xl flex items-center justify-center"
        >
          <i data-lucide="minus" class="w-6 h-6"></i>
        </button>
        <div class="w-24 text-center">
          <p class="text-4xl font-bold" x-text="cardioData.duration"></p>
        </div>
        <button
          type="button"
          @click="cardioData.duration += 5"
          class="w-14 h-14 bg-gray-700 rounded-xl flex items-center justify-center"
        >
          <i data-lucide="plus" class="w-6 h-6"></i>
        </button>
      </div>
      
      <!-- Quick select -->
      <div class="flex justify-center gap-2 mt-3">
        <template x-for="min in [20, 30, 45, 60]" :key="min">
          <button
            type="button"
            @click="cardioData.duration = min"
            class="px-4 py-2 rounded-lg text-sm transition-colors"
            :class="cardioData.duration === min ? 'bg-purple-500' : 'bg-gray-700'"
            x-text="min"
          ></button>
        </template>
      </div>
    </div>

    <!-- Podcast -->
    <div class="bg-gray-800 rounded-2xl p-4 mb-4">
      <p class="text-sm text-gray-400 mb-2">üéß –ü–æ–¥–∫–∞—Å—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</p>
      <input
        type="text"
        placeholder="NotebookLM: AI –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞..."
        x-model="cardioData.podcast"
        class="w-full bg-gray-700 rounded-xl p-3 outline-none focus:ring-2 focus:ring-purple-500"
      >
    </div>

    <button
      type="button"
      @click="page = 'complete'; saveSession()"
      class="w-full bg-purple-500 hover:bg-purple-600 rounded-xl py-4 font-bold text-lg active:scale-[0.98] transition-transform"
      x-text="isCardioOnly ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å –∫–∞—Ä–¥–∏–æ' : '–î–∞–ª–µ–µ ‚Üí'"
    ></button>
  </div>
  </template>

  <!-- ========== –°–¢–†–ê–ù–ò–¶–ê: COMPLETE ========== -->
  <template x-if="page === 'complete'">
  <div class="min-h-screen p-4">
    
    <!-- Success Header -->
    <div class="text-center mb-6">
      <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
        <i data-lucide="award" class="w-10 h-10 text-green-400"></i>
      </div>
      <h1 class="text-2xl font-bold mb-2">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! üí™</h1>
      <p class="text-gray-400">–û—Å—Ç–∞–ª–æ—Å—å –æ—Ü–µ–Ω–∏—Ç—å —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ</p>
    </div>

    <!-- Mood Post Workout -->
    <div class="bg-gray-800 rounded-2xl p-4 mb-4">
      <p class="text-sm text-gray-400 mb-3">–ö–∞–∫ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–µ–π—á–∞—Å?</p>
      <div class="flex items-center justify-between mb-2">
        <span class="text-3xl" x-text="getMoodEmoji(moodPost)"></span>
        <span class="text-4xl font-bold" x-text="moodPost"></span>
      </div>
      <div class="slider-with-fill">
        <div class="slider-track slider-track-bg"></div>
        <div class="slider-track slider-track-fill slider-track-fill-green" :style="`width: ${((moodPost - 1) / 9 * 100)}%`"></div>
        <input
          type="range"
          min="1"
          max="10"
          x-model="moodPost"
          class="slider-input"
        >
      </div>
      <div class="flex justify-between text-xs text-gray-500 mt-1">
        <span>–ü–ª–æ—Ö–æ</span>
        <span>–û—Ç–ª–∏—á–Ω–æ</span>
      </div>
    </div>

    <!-- Mood Day -->
    <div class="bg-gray-800 rounded-2xl p-4 mb-4">
      <p class="text-sm text-gray-400 mb-3">–û–±—â–µ–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ –∑–∞ –¥–µ–Ω—å</p>
      <div class="flex items-center justify-between mb-2">
        <span class="text-3xl" x-text="getMoodEmoji(moodDay)"></span>
        <span class="text-4xl font-bold" x-text="moodDay"></span>
      </div>
      <div class="slider-with-fill">
        <div class="slider-track slider-track-bg"></div>
        <div class="slider-track slider-track-fill slider-track-fill-blue" :style="`width: ${((moodDay - 1) / 9 * 100)}%`"></div>
        <input
          type="range"
          min="1"
          max="10"
          x-model="moodDay"
          class="slider-input"
        >
      </div>
    </div>

    <!-- Notes -->
    <div class="bg-gray-800 rounded-2xl p-4 mb-6">
      <p class="text-sm text-gray-400 mb-2">üìù –ó–∞–º–µ—Ç–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</p>
      <textarea
        placeholder="–ü–ª–µ—á–æ –ø–æ–±–∞–ª–∏–≤–∞–ª–æ, —Å–æ–∫—Ä–∞—Ç–∏–ª –≤–µ—Å –Ω–∞ –∂–∏–º–µ..."
        x-model="notes"
        class="w-full bg-gray-700 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 min-h-[80px] resize-none"
      ></textarea>
    </div>

    <!-- Save Button -->
    <button
      type="button"
      @click="saveWorkout()"
      class="w-full bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl py-4 font-bold text-lg flex items-center justify-center gap-2 active:scale-[0.98] transition-transform"
    >
      <i data-lucide="check" class="w-6 h-6"></i>
      –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
    </button>
  </div>
  </template>

  <!-- ========== –°–¢–†–ê–ù–ò–¶–ê: –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –¢–†–ï–ù–ò–†–û–í–ö–ò ========== -->
  <template x-if="page === 'edit-workout'">
  <div class="min-h-screen p-4 pb-24">
    <div class="flex items-center gap-3 mb-6">
      <button type="button" @click="page = 'dashboard'; editingWorkout = null" class="p-2 hover:bg-gray-800 rounded-lg">
        <i data-lucide="chevron-left" class="w-6 h-6"></i>
      </button>
      <h1 class="text-xl font-bold">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</h1>
    </div>
    <template x-if="editingWorkout">
      <div>
        <div class="bg-gray-800 rounded-2xl p-4 mb-4">
          <p class="text-sm text-gray-400" x-text="editingWorkout.date"></p>
          <p class="font-bold text-lg" x-text="editingWorkout.name"></p>
        </div>
        <div class="bg-gray-800 rounded-2xl p-4 mb-4">
          <p class="text-sm text-gray-400 mb-3">–ü–æ–¥—Ö–æ–¥—ã</p>
          <template x-for="(set, i) in (editingWorkout.sets || [])" :key="i">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-sm text-gray-500 w-24 shrink-0" x-text="set.exerciseName || '–°–µ—Ç ' + (i+1)"></span>
              <input type="number" min="0" step="2" x-model.number="set.weight" class="w-16 bg-gray-700 rounded-lg px-2 py-1 text-center">
              <span class="text-gray-500">–∫–≥ √ó</span>
              <input type="number" min="1" x-model.number="set.reps" class="w-14 bg-gray-700 rounded-lg px-2 py-1 text-center">
              <button type="button" @click="editingWorkout.sets.splice(i, 1)" class="p-1 text-red-400 hover:bg-red-500/20 rounded">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </div>
          </template>
        </div>
        <div class="bg-gray-800 rounded-2xl p-4 mb-4" x-show="editingWorkout.cardio">
          <p class="text-sm text-gray-400 mb-2">–ö–∞—Ä–¥–∏–æ</p>
          <div class="flex items-center gap-2">
            <input type="number" min="0" x-model.number="editingWorkout.cardio.duration" class="w-20 bg-gray-700 rounded-lg px-2 py-1">
            <span class="text-gray-500">–º–∏–Ω</span>
          </div>
        </div>
        <div class="bg-gray-800 rounded-2xl p-4 mb-4">
          <p class="text-sm text-gray-400 mb-2">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p>
          <input type="range" min="1" max="10" x-model.number="editingWorkout.moodPost" class="w-full">
          <span x-text="editingWorkout.moodPost ?? editingWorkout.mood ?? 7"></span>/10
        </div>
        <div class="bg-gray-800 rounded-2xl p-4 mb-4">
          <p class="text-sm text-gray-400 mb-2">–°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ –∑–∞ –¥–µ–Ω—å</p>
          <input type="range" min="1" max="10" x-model.number="editingWorkout.moodDay" class="w-full">
          <span x-text="editingWorkout.moodDay ?? 7"></span>/10
        </div>
        <div class="bg-gray-800 rounded-2xl p-4 mb-4">
          <p class="text-sm text-gray-400 mb-2">–ó–∞–º–µ—Ç–∫–∏</p>
          <textarea x-model="editingWorkout.notes" class="w-full bg-gray-700 rounded-xl p-3 min-h-[60px]"></textarea>
        </div>
        <button
          type="button"
          @click="saveEditedWorkout()"
          class="w-full bg-green-500 hover:bg-green-600 rounded-xl py-3 font-bold"
        >
          –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        </button>
      </div>
    </template>
  </div>
  </template>

  <!-- ========== –°–¢–†–ê–ù–ò–¶–ê: –£–ü–†–ê–í–õ–ï–ù–ò–ï –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø–ú–ò ========== -->
  <template x-if="page === 'manage-exercises'">
  <div class="min-h-screen p-4 pb-24">
    <div class="flex items-center gap-3 mb-6">
      <button type="button" @click="managingWorkoutKey ? backToWorkoutList() : (page = 'select-workout')" class="p-2 hover:bg-gray-800 rounded-lg">
        <i data-lucide="chevron-left" class="w-6 h-6"></i>
      </button>
      <h1 class="text-xl font-bold" x-text="managingWorkoutKey ? (workouts[managingWorkoutKey]?.name || '') : '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏'"></h1>
    </div>
    
    <template x-if="!managingWorkoutKey">
      <div class="space-y-2">
        <template x-for="w in workoutList" :key="w.key">
          <button type="button" @click="selectWorkoutToManage(w.key)" class="w-full flex items-center gap-3 p-4 rounded-xl bg-gray-800 hover:bg-gray-700">
            <span class="text-2xl" x-text="w.emoji"></span>
            <div class="flex-1 text-left">
              <p class="font-bold" x-text="w.name"></p>
              <p class="text-sm text-gray-400" x-text="(w.exercises?.length || 0) + ' —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π'"></p>
            </div>
            <i data-lucide="chevron-right" class="w-5 h-5"></i>
          </button>
        </template>
      </div>
    </template>
    
    <template x-if="managingWorkoutKey && editingExerciseIndex === -1">
      <div>
        <div class="space-y-2 mb-4">
          <template x-for="(ex, i) in (workouts[managingWorkoutKey]?.exercises || [])" :key="i">
            <div class="flex items-center gap-3 p-3 rounded-xl bg-gray-800">
              <div class="w-10 h-10 rounded-lg bg-gray-700 flex items-center justify-center" x-html="getExerciseIcon(ex.icon)"></div>
              <div class="flex-1">
                <p class="font-medium" x-text="ex.name"></p>
                <p class="text-xs text-gray-400" x-text="(ex.sets || 3) + '√ó' + (ex.reps || 12)"></p>
              </div>
              <button type="button" @click="startEditExercise(i)" class="p-2 hover:bg-gray-600 rounded-lg"><i data-lucide="pencil" class="w-4 h-4"></i></button>
              <button type="button" @click="deleteExerciseFromTemplate(i)" class="p-2 hover:bg-red-500/30 rounded-lg text-red-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>
          </template>
        </div>
        <button type="button" @click="startAddExercise()" class="w-full py-3 rounded-xl bg-blue-500 hover:bg-blue-600 font-semibold flex items-center justify-center gap-2">
          <i data-lucide="plus" class="w-5 h-5"></i>
          –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
        </button>
      </div>
    </template>
    
    <template x-if="managingWorkoutKey && editingExerciseIndex !== -1">
      <div class="bg-gray-800 rounded-2xl p-4">
        <p class="text-sm text-gray-400 mb-3" x-text="editingExerciseIndex >= 0 ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ'"></p>
        <div class="space-y-3">
          <div>
            <label class="text-sm text-gray-400">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input type="text" x-model="exerciseForm.name" class="w-full bg-gray-700 rounded-lg p-3 mt-1" placeholder="–ñ–∏–º –ª—ë–∂–∞">
          </div>
          <div class="flex gap-3">
            <div class="flex-1">
              <label class="text-sm text-gray-400">–°–µ—Ç—ã</label>
              <input type="number" min="1" x-model.number="exerciseForm.sets" class="w-full bg-gray-700 rounded-lg p-3 mt-1">
            </div>
            <div class="flex-1">
              <label class="text-sm text-gray-400">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</label>
              <input type="number" min="1" x-model.number="exerciseForm.reps" class="w-full bg-gray-700 rounded-lg p-3 mt-1">
            </div>
          </div>
          <div>
            <label class="text-sm text-gray-400">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
            <input type="text" x-model="exerciseForm.altsStr" class="w-full bg-gray-700 rounded-lg p-3 mt-1" placeholder="–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è, –¢—è–≥–∞ –≤ –≥—Ä–∞–≤–∏—Ç—Ä–æ–Ω–µ">
          </div>
          <div>
            <label class="text-sm text-gray-400">–ò–∫–æ–Ω–∫–∞</label>
            <select x-model="exerciseForm.icon" class="w-full bg-gray-700 rounded-lg p-3 mt-1">
              <template x-for="k in getIconKeys()" :key="k">
                <option :value="k" x-text="k"></option>
              </template>
            </select>
          </div>
          <div class="flex gap-2">
            <button type="button" @click="saveExercise()" class="flex-1 py-3 rounded-xl bg-green-500 hover:bg-green-600 font-semibold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" @click="editingExerciseIndex = -1" class="flex-1 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 font-semibold">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      </div>
    </template>
  </div>
  </template>

  <!-- Scripts - –ü–û–†–Ø–î–û–ö –í–ê–ñ–ï–ù! -->
  <script src="./js/data.js"></script>
  <script src="./js/storage.js"></script>
  <script src="./icons/exercises.js"></script>
  <script src="./js/app.js"></script>
  
  <!-- Lucide Icons init -->
  <script>
    document.addEventListener('alpine:initialized', () => {
      console.log('Alpine initialized, creating icons...');
      lucide.createIcons();
      
      var createIconsTimer;
      const observer = new MutationObserver(() => {
        clearTimeout(createIconsTimer);
        createIconsTimer = setTimeout(() => lucide.createIcons(), 50);
      });
      observer.observe(document.body, { childList: true, subtree: true });
    });
  </script>
  
  <!-- Register Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('SW registered:', reg.scope))
          .catch(err => console.warn('SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
